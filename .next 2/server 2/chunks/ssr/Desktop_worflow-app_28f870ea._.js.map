{"version":3,"sources":["../../../../../../Desktop/worflow-app/node_modules/next/src/build/webpack/loaders/next-flight-loader/action-validate.ts","../../../../../../Desktop/worflow-app/actions/user-actions.ts","../../../../../../Desktop/worflow-app/actions/project-actions.ts","../../../../../../Desktop/worflow-app/.next-internal/server/app/%28authenticated%29/projects/new/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["// This function ensures that all the exported values are valid server actions,\n// during the runtime. By definition all actions are required to be async\n// functions, but here we can only check that they are functions.\nexport function ensureServerEntryExports(actions: any[]) {\n  for (let i = 0; i < actions.length; i++) {\n    const action = actions[i]\n    if (typeof action !== 'function') {\n      throw new Error(\n        `A \"use server\" file can only export async functions, found ${typeof action}.\\nRead more: https://nextjs.org/docs/messages/invalid-use-server-value`\n      )\n    }\n  }\n}\n","\"use server\"\n\nimport { auth } from \"@/auth\"\nimport { prisma } from \"@/lib/prisma\"\nimport { revalidatePath } from \"next/cache\"\n\nexport async function getUsers() {\n    const session = await auth()\n    if (!session?.user?.id) return []\n\n    try {\n        // @ts-ignore\n        const users = await prisma.user.findMany({\n            select: {\n                id: true,\n                name: true,\n                email: true,\n                avatarUrl: true,\n                role: true,\n                managerId: true,\n                manager: {\n                    select: { id: true, name: true }\n                }\n            },\n            orderBy: { name: 'asc' }\n        })\n        return users\n    } catch (error) {\n        console.error(\"Failed to fetch users:\", error)\n        return []\n    }\n}\n\nexport async function updateUserRoleAndManager(userId: string, role: string, managerId: string | null) {\n    const session = await auth()\n    // Authorization check: only admin or manager should do this? \n    // For now allow any authenticated user for simplicity as per request context\n    if (!session?.user?.id) return { error: \"Unauthorized\" }\n\n    try {\n        await prisma.user.update({\n            where: { id: userId },\n            data: {\n                role,\n                managerId: managerId === \"none\" ? null : managerId\n            }\n        })\n        revalidatePath(\"/settings/users\")\n        return { success: true }\n    } catch (error) {\n        console.error(\"Failed to update user:\", error)\n        return { error: \"Failed to update user\" }\n    }\n}\n","\"use server\"\n\nimport { auth } from \"@/auth\"\nimport { prisma } from \"@/lib/prisma\"\nimport { revalidatePath } from \"next/cache\"\nimport { z } from \"zod\"\n\nconst projectSchema = z.object({\n    name: z.string().min(2),\n    code: z.string().min(2).max(10).toUpperCase(),\n    description: z.string().optional(),\n})\n\n\n\nexport async function getProjects(query?: string) {\n    const session = await auth()\n    if (!session?.user?.id) return []\n\n    try {\n        return await prisma.project.findMany({\n            where: {\n                users: { some: { id: session.user.id } },\n                ...(query ? {\n                    OR: [\n                        { name: { contains: query } },\n                        { code: { contains: query } }\n                    ]\n                } : {})\n            },\n            orderBy: { updatedAt: \"desc\" },\n            include: {\n                _count: {\n                    select: { workItems: true }\n                },\n                users: {\n                    select: { id: true, name: true, avatarUrl: true }\n                },\n                workItems: {\n                    orderBy: { updatedAt: 'desc' },\n                    take: 20 // Limit for now, or paginate later\n                }\n            }\n        })\n    } catch (error) {\n        console.error(\"Failed to fetch projects:\", error)\n        return []\n    }\n}\n\nexport async function getProjectByCode(code: string) {\n    const session = await auth()\n    if (!session?.user?.id) return null\n\n    try {\n        const project = await prisma.project.findUnique({\n            where: { code },\n            include: {\n                // @ts-ignore\n                users: {\n                    select: {\n                        id: true,\n                        name: true,\n                        email: true,\n                        avatarUrl: true\n                    }\n                },\n                // Include team roles\n                manager: { select: { id: true, name: true, email: true, avatarUrl: true } },\n                senior: { select: { id: true, name: true, email: true, avatarUrl: true } },\n                associate: { select: { id: true, name: true, email: true, avatarUrl: true } },\n                assignedTemplates: true,\n                workItems: {\n                    orderBy: { updatedAt: 'desc' },\n                    take: 20\n                }\n            }\n        })\n        return project\n    } catch (error) {\n        console.error(\"Failed to fetch project:\", error)\n        return null\n    }\n}\n\nexport async function createProject(formData: FormData) {\n    const session = await auth()\n    if (!session?.user?.id) return { error: \"Unauthorized\" }\n\n    const rawData = {\n        name: formData.get(\"name\"),\n        code: formData.get(\"code\"),\n        description: formData.get(\"description\"),\n    }\n\n    const validated = projectSchema.safeParse(rawData)\n\n    if (!validated.success) {\n        return { error: validated.error.flatten().fieldErrors }\n    }\n\n    try {\n        await prisma.project.create({\n            data: {\n                ...validated.data,\n                users: {\n                    connect: { id: session.user.id }\n                }\n            }\n        })\n        revalidatePath(\"/projects\")\n        return { success: true }\n    } catch (error) {\n        return { error: \"Failed to create project. Code might be duplicate.\" }\n    }\n}\n\nexport async function updateProjectAccess(code: string, userIds: string[]) {\n    const session = await auth()\n    if (!session?.user?.id) return { error: \"Unauthorized\" }\n\n    try {\n        // First verify user has access to this project\n        const project = await prisma.project.findFirst({\n            where: {\n                code,\n                users: { some: { id: session.user.id } }\n            }\n        })\n\n        if (!project) return { error: \"Project not found or unauthorized\" }\n\n        await prisma.project.update({\n            where: { code },\n            data: {\n                users: {\n                    set: userIds.map(id => ({ id }))\n                }\n            }\n        })\n\n        revalidatePath(`/projects/${code}`)\n        revalidatePath(\"/projects\")\n        return { success: true }\n    } catch (error) {\n        console.error(\"Failed to update project access:\", error)\n        return { error: \"Failed to update access\" }\n    }\n}\n\nexport async function updateProjectTeam(\n    code: string,\n    team: {\n        managerId?: string,\n        seniorId?: string,\n        associateId?: string,\n        allowedTaskTypes?: string,\n        assignedTemplateIds?: string[]\n    }\n) {\n    const session = await auth()\n    if (!session?.user?.id) return { error: \"Unauthorized\" }\n\n    try {\n        const data: any = {\n            managerId: team.managerId === \"none\" ? null : team.managerId,\n            seniorId: team.seniorId === \"none\" ? null : team.seniorId,\n            associateId: team.associateId === \"none\" ? null : team.associateId,\n            allowedTaskTypes: team.allowedTaskTypes\n        }\n\n        if (team.assignedTemplateIds) {\n            data.assignedTemplates = {\n                set: team.assignedTemplateIds.map(id => ({ id }))\n            }\n        }\n\n        await prisma.project.update({\n            where: { code },\n            data\n        })\n\n        revalidatePath(`/projects/${code}`)\n        return { success: true }\n    } catch (error) {\n        console.error(\"Failed to update project team:\", error)\n        return { error: \"Failed to update project team\" }\n    }\n}\n","export {$$RSC_SERVER_ACTION_0 as '001ceff8282c4239bec770d6cac094d371cf582016'} from 'ACTIONS_MODULE0'\nexport {createProject as '40e7def66ffb97f0baff30760441528635c50f2cb4'} from 'ACTIONS_MODULE1'\nexport {getUsers as '00052ab1fab1b8579fa088cb15217f3f2c849b69f1'} from 'ACTIONS_MODULE2'\nexport {updateUserRoleAndManager as '70efc01e1693331f116310be4b7f9679e63cbd9d54'} from 'ACTIONS_MODULE2'\n"],"names":["ensureServerEntryExports","actions","i","length","action","Error"],"mappings":"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","ignoreList":[0]}