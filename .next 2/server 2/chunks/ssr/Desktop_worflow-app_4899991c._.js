module.exports=[53115,(a,b,c)=>{"use strict";function d(a){for(let b=0;b<a.length;b++){let c=a[b];if("function"!=typeof c)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof c}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ensureServerEntryExports",{enumerable:!0,get:function(){return d}})},44663,58473,25873,a=>{"use strict";let b=Symbol.for("constructDateFrom");function c(a,c){return"function"==typeof a?a(c):a&&"object"==typeof a&&b in a?a[b](c):a instanceof Date?new a.constructor(c):new Date(c)}function d(a,b){return c(b||a,a)}a.s(["constructFromSymbol",0,b,"minutesInDay",0,1440,"minutesInMonth",0,43200],58473),a.s(["constructFrom",()=>c],25873),a.s(["toDate",()=>d],44663)},77103,a=>{"use strict";var b=a.i(25873),c=a.i(44663);function d(a,d,e){let f=(0,c.toDate)(a,e?.in);return isNaN(d)?(0,b.constructFrom)(e?.in||a,NaN):(d&&f.setDate(f.getDate()+d),f)}a.s(["addDays",()=>d])},67761,a=>{"use strict";var b=a.i(51223),c=a.i(49341),d=a.i(13666),e=a.i(63270),f=a.i(66975),g=a.i(77103);function h(a,b,c){return(0,g.addDays)(a,7*b,c)}var i=a.i(25873),j=a.i(44663);function k(a,b,c){let d=(0,j.toDate)(a,c?.in);if(isNaN(b))return(0,i.constructFrom)(c?.in||a,NaN);if(!b)return d;let e=d.getDate(),f=(0,i.constructFrom)(c?.in||a,d.getTime());return(f.setMonth(d.getMonth()+b+1,0),e>=f.getDate())?f:(d.setFullYear(f.getFullYear(),f.getMonth(),e),d)}var l=a.i(53115);let m=c.z.object({title:c.z.string().min(1),description:c.z.string().optional(),status:c.z.string().default("OPEN"),priority:c.z.string().default("P2"),driveLink:c.z.string().optional().nullable(),driveLinkType:c.z.string().optional().nullable(),requiresDocument:c.z.boolean().default(!1),dueDate:c.z.string().optional().nullable().transform(a=>a?new Date(a):null),isRecurring:c.z.boolean().default(!1),recurrenceInterval:c.z.enum(["DAILY","WEEKLY","MONTHLY","QUARTERLY","YEARLY"]).or(c.z.literal("")).optional().nullable().transform(a=>""===a?null:a),recurrenceDays:c.z.string().optional().nullable(),projectId:c.z.string().optional().nullable(),taskType:c.z.string().optional().nullable()}).refine(a=>!a.isRecurring||!!a.dueDate,{message:"Due date is required for recurring tasks",path:["dueDate"]}).refine(a=>!a.projectId||!!a.taskType,{message:"Task Type is required for project tasks",path:["taskType"]});async function n(a){let b=await (0,e.auth)();if(!b?.user?.id)return{success:!1,message:"Unauthorized"};let g={title:a.get("title"),description:a.get("description"),status:a.get("status")||"OPEN",priority:a.get("priority")||"P2",driveLink:a.get("driveLink"),driveLinkType:a.get("driveLinkType"),requiresDocument:"on"===a.get("requiresDocument"),dueDate:a.get("dueDate"),isRecurring:!!a.get("recurrenceInterval"),recurrenceInterval:a.get("recurrenceInterval")||null,recurrenceDays:a.get("recurrenceDays")||null,projectId:"none"===a.get("projectId")?null:a.get("projectId"),taskType:"none"===a.get("taskType")?null:a.get("taskType")};try{let a=m.parse(g);if(a.isRecurring&&"WEEKLY"===a.recurrenceInterval&&!a.recurrenceDays)return{success:!1,message:"Weekly recurrence requires at least one day selected."};return await d.prisma.workItem.create({data:{title:a.title,description:a.description,status:a.status,priority:a.priority,driveLink:a.driveLink||null,driveLinkType:a.driveLinkType||null,requiresDocument:a.requiresDocument,dueDate:a.dueDate,assigneeId:b.user.id,isRecurring:a.isRecurring,recurrenceInterval:a.isRecurring?a.recurrenceInterval:null,recurrenceDays:a.isRecurring?a.recurrenceDays:null,projectId:a.projectId||null,taskType:a.taskType||null}}),(0,f.revalidatePath)("/work"),(0,f.revalidatePath)("/dashboard"),(0,f.revalidatePath)("/clients"),{success:!0}}catch(a){if(a instanceof c.z.ZodError)return console.error("Validation failed:",a.flatten()),{success:!1,message:"Validation failed. Please check your inputs.",errors:a.flatten().fieldErrors};return console.error("Failed to create task:",a),{success:!1,message:"Failed to create task"}}}async function o(a,b){let c=await (0,e.auth)();if(!c?.user?.id)return{success:!1,message:"Unauthorized"};try{let c=await d.prisma.workItem.findUnique({where:{id:a}});if(!c)return{success:!1,message:"Task not found"};if("DONE"===b&&c.requiresDocument&&!c.driveLink)return{success:!1,message:"Document required to complete this task.",requiresDocument:!0};if("DONE"===b&&c.isRecurring&&c.recurrenceInterval){let a=function(a,b,c){let d=new Date(a);if(d.setHours(0,0,0,0),"WEEKLY"===b&&c){let a=c.split(",").map(a=>a.trim()),b={Sun:0,Mon:1,Tue:2,Wed:3,Thu:4,Fri:5,Sat:6},e=a.map(a=>b[a]).sort((a,b)=>a-b);if(0===e.length)return h(d,1);let f=d.getDay(),i=e.find(a=>a>f);if(void 0!==i)return(0,g.addDays)(d,i-f);{let a=e[0];return(0,g.addDays)(d,7-f+a)}}switch(b){case"DAILY":default:return(0,g.addDays)(d,1);case"WEEKLY":return h(d,1);case"MONTHLY":return k(d,1);case"QUARTERLY":return k(d,3,void 0);case"YEARLY":return k(d,12,void 0)}}(new Date,c.recurrenceInterval,c.recurrenceDays);await d.prisma.workItem.create({data:{title:c.title,description:c.description,status:"OPEN",priority:c.priority,projectId:c.projectId,assigneeId:c.assigneeId,requiresDocument:c.requiresDocument,isRecurring:!0,recurrenceInterval:c.recurrenceInterval,recurrenceDays:c.recurrenceDays,dueDate:a}})}return await d.prisma.workItem.update({where:{id:a},data:{status:b,completedAt:"DONE"===b?new Date:null}}),(0,f.revalidatePath)("/work"),(0,f.revalidatePath)("/dashboard"),{success:!0,message:"Task updated"}}catch(a){return console.error("Failed to update status:",a),{success:!1,message:"Failed to update status"}}}async function p(a,b){let g=await (0,e.auth)();if(!g?.user?.id)return{success:!1,message:"Unauthorized"};if(!c.z.string().url().safeParse(b).success)return{success:!1,message:"Invalid URL"};try{return await d.prisma.workItem.update({where:{id:a},data:{driveLink:b,driveLinkType:"file"}}),(0,f.revalidatePath)("/work"),{success:!0,message:"Link added"}}catch(a){return console.error("Failed to add link:",a),{success:!1,message:"Failed to add link"}}}async function q(a){let b=await (0,e.auth)();if(!b?.user?.id)return[];let c=b.user.id,f=await d.prisma.user.findUnique({where:{id:c},include:{manager:!0,directReports:{include:{directReports:!0}}}});if(!f)return[];let g=[c];"SENIOR"===f.role?g=[...g,...f.directReports.map(a=>a.id)]:"MANAGER"===f.role?g=[...g,...f.directReports.map(a=>a.id),...f.directReports.flatMap(a=>a.directReports.map(a=>a.id))]:"ADMIN"===f.role&&(g=[]);let h={...a?.projectId?{projectId:a.projectId}:{},...a?.status?{status:a.status}:{},...a?.search?{OR:[{title:{contains:a.search}},{description:{contains:a.search}}]}:{}};if("ADMIN"!==f.role?h.assigneeId={in:g}:a?.assigneeId&&(h.assigneeId=a.assigneeId),a?.assigneeId&&"ADMIN"!==f.role)if(!g.includes(a.assigneeId))return[];else h.assigneeId=a.assigneeId;try{return await d.prisma.workItem.findMany({where:h,orderBy:{updatedAt:"desc"},include:{project:{select:{code:!0,name:!0}},assignee:{select:{name:!0,avatarUrl:!0}}}})}catch(a){return console.error("Failed to get work items:",a),[]}}async function r(a,b){let c=await (0,e.auth)();if(!c?.user?.id)return{success:!1,message:"Unauthorized"};try{let c={title:b.get("title"),description:b.get("description"),priority:b.get("priority"),dueDate:b.get("dueDate")?new Date(b.get("dueDate")):null,assigneeId:b.get("assigneeId")||null};return await d.prisma.workItem.update({where:{id:a},data:{title:c.title,description:c.description,priority:c.priority,dueDate:c.dueDate,assigneeId:c.assigneeId}}),(0,f.revalidatePath)("/work"),(0,f.revalidatePath)("/dashboard"),(0,f.revalidatePath)("/projects"),{success:!0,message:"Task updated"}}catch(a){return console.error("Failed to update task details:",a),{success:!1,message:"Failed to update task"}}}(0,l.ensureServerEntryExports)([n,o,p,q,r]),(0,b.registerServerReference)(n,"40de94d4fb47b51c032dc1b7c6904a3de8ef162157",null),(0,b.registerServerReference)(o,"608cd521f1bcabf563c0befe8fca451c47b273ae83",null),(0,b.registerServerReference)(p,"606c4a5080886e51df4612ed481e375dbbea6efeea",null),(0,b.registerServerReference)(q,"4029096d674055419dc222a9725bbb7f671bbd253e",null),(0,b.registerServerReference)(r,"60f7368a61b3983e3a158b9de58e792547353665de",null),a.s(["addDocumentLink",()=>p,"createTask",()=>n,"getWorkItems",()=>q,"updateTaskDetails",()=>r,"updateTaskStatus",()=>o],67761)},93269,a=>{"use strict";var b=a.i(43379),c=a.i(67761);a.s([],12468),a.i(12468),a.s(["001ceff8282c4239bec770d6cac094d371cf582016",()=>b.$$RSC_SERVER_ACTION_0,"40de94d4fb47b51c032dc1b7c6904a3de8ef162157",()=>c.createTask,"606c4a5080886e51df4612ed481e375dbbea6efeea",()=>c.addDocumentLink,"608cd521f1bcabf563c0befe8fca451c47b273ae83",()=>c.updateTaskStatus],93269)}];

//# sourceMappingURL=Desktop_worflow-app_4899991c._.js.map