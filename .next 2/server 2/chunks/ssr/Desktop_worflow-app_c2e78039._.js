module.exports=[53115,(a,b,c)=>{"use strict";function d(a){for(let b=0;b<a.length;b++){let c=a[b];if("function"!=typeof c)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof c}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ensureServerEntryExports",{enumerable:!0,get:function(){return d}})},69744,a=>{"use strict";var b=a.i(51223),c=a.i(63270),d=a.i(13666),e=a.i(66975),f=a.i(49341),g=a.i(53115);let h=f.z.object({workItemId:f.z.string().optional(),durationMinutes:f.z.coerce.number().min(1,"Duration must be at least 1 minute"),notes:f.z.string().optional(),date:f.z.string().refine(a=>!isNaN(Date.parse(a)),{message:"Invalid date"})});async function i(a){let b=await (0,c.auth)();if(!b?.user?.id)return{error:"Unauthorized"};let f={workItemId:a.get("workItemId")||void 0,durationMinutes:a.get("durationMinutes"),notes:a.get("notes"),date:a.get("date"),projectId:a.get("projectId")||void 0},g=h.safeParse(f);if(!g.success)return{error:g.error.flatten().fieldErrors};let{workItemId:i,durationMinutes:j,notes:k,date:l}=g.data,m=new Date(l);try{let a=f.projectId||null,c=!0;if(i){let b=await d.prisma.workItem.findUnique({where:{id:i},select:{projectId:!0,project:{select:{isBillable:!0}}}});b&&(a=b.projectId,b.project&&(c=b.project.isBillable))}else if(a){let b=await d.prisma.project.findUnique({where:{id:a},select:{isBillable:!0}});b&&(c=b.isBillable)}return await d.prisma.timeEntry.create({data:{userId:b.user.id,workItemId:i||null,projectId:a,durationSeconds:60*j,startedAt:m,notes:k,isBillable:c}}),(0,e.revalidatePath)("/time"),(0,e.revalidatePath)("/dashboard"),(0,e.revalidatePath)("/work"),{success:!0}}catch(a){return console.error("Failed to log time:",a),{error:"Failed to log time"}}}async function j(a,b){let f=await (0,c.auth)();if(!f?.user?.id)return{error:"Unauthorized"};let g=Number(b.get("durationMinutes")),h=b.get("notes"),i=b.get("date");try{return await d.prisma.timeEntry.update({where:{id:a},data:{durationSeconds:60*g,notes:h,startedAt:new Date(i)}}),(0,e.revalidatePath)("/time"),{success:!0}}catch(a){return{error:"Failed to update"}}}async function k(a){let b=await (0,c.auth)();if(!b?.user?.id)return{error:"Unauthorized"};try{return await d.prisma.timeEntry.delete({where:{id:a}}),(0,e.revalidatePath)("/time"),{success:!0}}catch(a){return{error:"Failed to delete"}}}async function l(a){let b=await (0,c.auth)();if(!b?.user?.id)return[];let e=new Date(a);e.setHours(0,0,0,0);let f=new Date(a);return f.setHours(23,59,59,999),await d.prisma.timeEntry.findMany({where:{userId:b.user.id,startedAt:{gte:e,lte:f}},include:{project:!0,workItem:!0},orderBy:{startedAt:"desc"}})}async function m(a){let b=await (0,c.auth)();if(!b?.user?.id)return[];let e=new Date(a),f=e.getDay(),g=e.getDate()-f+(0===f?-6:1),h=new Date(e.setDate(g));h.setHours(0,0,0,0);let i=new Date(h);return i.setDate(h.getDate()+6),i.setHours(23,59,59,999),await d.prisma.timeEntry.findMany({where:{userId:b.user.id,startedAt:{gte:h,lte:i}},include:{project:!0,workItem:!0},orderBy:{startedAt:"desc"}})}async function n(){let a=await (0,c.auth)();return a?.user?.id?await d.prisma.timeEntry.findMany({where:{userId:a.user.id},orderBy:{startedAt:"desc"},take:20,include:{workItem:{select:{title:!0,project:{select:{name:!0}}}}}}):[]}async function o(){let a=await (0,c.auth)();if(!a?.user?.id)return{totalSeconds:0,entries:[]};let b=new Date,e=new Date(b.setDate(b.getDate()-b.getDay()));e.setHours(0,0,0,0);let f=await d.prisma.timeEntry.findMany({where:{userId:a.user.id,startedAt:{gte:e}}});return{totalSeconds:f.reduce((a,b)=>a+b.durationSeconds,0),count:f.length}}async function p(a,b,e){let f=await (0,c.auth)();if(!f?.user?.id)return{error:"Unauthorized"};let g={startedAt:{gte:a,lte:b}};e?.userId&&(g.userId=e.userId),e?.projectId&&(g.projectId=e.projectId);try{let a=await d.prisma.timeEntry.findMany({where:g,include:{user:{select:{name:!0,billableRate:!0}},project:{select:{name:!0,billableRate:!0,isBillable:!0}},workItem:{select:{title:!0}}},orderBy:{startedAt:"desc"}}),b=0,c=0,e=0,f=0,h={};return a.forEach(a=>{let d=a.durationSeconds/3600;b+=d;let g=a.startedAt.toISOString().split("T")[0];h[g]=(h[g]||0)+d;let i=a.project?.billableRate??a.user.billableRate??0;a.isBillable&&(a.project?.isBillable??!0)?(c+=d,e+=d*i):f+=d*i}),{summary:{totalHours:b,billableHours:c,billableAmount:e,unbilledAmount:f,utilization:b>0?c/b*100:0},chartData:Object.entries(h).map(([a,b])=>({date:a,hours:b})).sort((a,b)=>a.date.localeCompare(b.date)),entries:a}}catch(a){return console.error("Failed to fetch report data:",a),{error:"Failed to fetch report data"}}}(0,g.ensureServerEntryExports)([i,j,k,l,m,n,o,p]),(0,b.registerServerReference)(i,"40deae6ebaa52a70822af3eb0b42528abe6cf6d7c3",null),(0,b.registerServerReference)(j,"60d99d512224072820df7e1159eacbb586c5005db0",null),(0,b.registerServerReference)(k,"400c47ae8a89147b1091c561c4c4b1e3ca9240ab94",null),(0,b.registerServerReference)(l,"4065cd69cb70ccd22858f791e78db2773536cde888",null),(0,b.registerServerReference)(m,"4089bdcc2a85a95426ecb675bc92504aa16935b62f",null),(0,b.registerServerReference)(n,"00257455a1f802617d436aabdafc3097c7550037d4",null),(0,b.registerServerReference)(o,"000b9d26d6f76e437f5a613fac1daf7261cc91b502",null),(0,b.registerServerReference)(p,"70860bd8f29cf04b16df2cd09e644336685fb2121a",null),a.s(["deleteTimeEntry",()=>k,"getDailyEntries",()=>l,"getRecentTimeEntries",()=>n,"getReportData",()=>p,"getWeeklyEntries",()=>m,"getWeeklySummary",()=>o,"logTime",()=>i,"updateTimeEntry",()=>j])},35195,a=>{"use strict";var b=a.i(43379),c=a.i(69744);a.s([],69111),a.i(69111),a.s(["000b9d26d6f76e437f5a613fac1daf7261cc91b502",()=>c.getWeeklySummary,"001ceff8282c4239bec770d6cac094d371cf582016",()=>b.$$RSC_SERVER_ACTION_0,"00257455a1f802617d436aabdafc3097c7550037d4",()=>c.getRecentTimeEntries,"400c47ae8a89147b1091c561c4c4b1e3ca9240ab94",()=>c.deleteTimeEntry,"4065cd69cb70ccd22858f791e78db2773536cde888",()=>c.getDailyEntries,"4089bdcc2a85a95426ecb675bc92504aa16935b62f",()=>c.getWeeklyEntries,"40deae6ebaa52a70822af3eb0b42528abe6cf6d7c3",()=>c.logTime,"60d99d512224072820df7e1159eacbb586c5005db0",()=>c.updateTimeEntry,"70860bd8f29cf04b16df2cd09e644336685fb2121a",()=>c.getReportData],35195)}];

//# sourceMappingURL=Desktop_worflow-app_c2e78039._.js.map