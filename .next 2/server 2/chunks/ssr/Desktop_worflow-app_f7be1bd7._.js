module.exports=[53115,(a,b,c)=>{"use strict";function d(a){for(let b=0;b<a.length;b++){let c=a[b];if("function"!=typeof c)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof c}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ensureServerEntryExports",{enumerable:!0,get:function(){return d}})},45879,a=>{"use strict";var b=a.i(51223),c=a.i(63270),d=a.i(13666),e=a.i(66975),f=a.i(49341),g=a.i(53115);let h=f.z.object({name:f.z.string().min(2),code:f.z.string().min(2).max(10).toUpperCase(),description:f.z.string().optional()});async function i(a){let b=await (0,c.auth)();if(!b?.user?.id)return[];try{return await d.prisma.project.findMany({where:{users:{some:{id:b.user.id}},...a?{OR:[{name:{contains:a}},{code:{contains:a}}]}:{}},orderBy:{updatedAt:"desc"},include:{_count:{select:{workItems:!0}},users:{select:{id:!0,name:!0,avatarUrl:!0}},workItems:{orderBy:{updatedAt:"desc"},take:20}}})}catch(a){return console.error("Failed to fetch projects:",a),[]}}async function j(a){let b=await (0,c.auth)();if(!b?.user?.id)return null;try{return await d.prisma.project.findUnique({where:{code:a},include:{users:{select:{id:!0,name:!0,email:!0,avatarUrl:!0}},manager:{select:{id:!0,name:!0,email:!0,avatarUrl:!0}},senior:{select:{id:!0,name:!0,email:!0,avatarUrl:!0}},associate:{select:{id:!0,name:!0,email:!0,avatarUrl:!0}},assignedTemplates:!0,workItems:{orderBy:{updatedAt:"desc"},take:20}}})}catch(a){return console.error("Failed to fetch project:",a),null}}async function k(a){let b=await (0,c.auth)();if(!b?.user?.id)return{error:"Unauthorized"};let f={name:a.get("name"),code:a.get("code"),description:a.get("description")},g=h.safeParse(f);if(!g.success)return{error:g.error.flatten().fieldErrors};try{return await d.prisma.project.create({data:{...g.data,users:{connect:{id:b.user.id}}}}),(0,e.revalidatePath)("/projects"),{success:!0}}catch(a){return{error:"Failed to create project. Code might be duplicate."}}}async function l(a,b){let f=await (0,c.auth)();if(!f?.user?.id)return{error:"Unauthorized"};try{if(!await d.prisma.project.findFirst({where:{code:a,users:{some:{id:f.user.id}}}}))return{error:"Project not found or unauthorized"};return await d.prisma.project.update({where:{code:a},data:{users:{set:b.map(a=>({id:a}))}}}),(0,e.revalidatePath)(`/projects/${a}`),(0,e.revalidatePath)("/projects"),{success:!0}}catch(a){return console.error("Failed to update project access:",a),{error:"Failed to update access"}}}async function m(a,b){let f=await (0,c.auth)();if(!f?.user?.id)return{error:"Unauthorized"};try{let c={managerId:"none"===b.managerId?null:b.managerId,seniorId:"none"===b.seniorId?null:b.seniorId,associateId:"none"===b.associateId?null:b.associateId,allowedTaskTypes:b.allowedTaskTypes};return b.assignedTemplateIds&&(c.assignedTemplates={set:b.assignedTemplateIds.map(a=>({id:a}))}),await d.prisma.project.update({where:{code:a},data:c}),(0,e.revalidatePath)(`/projects/${a}`),{success:!0}}catch(a){return console.error("Failed to update project team:",a),{error:"Failed to update project team"}}}(0,g.ensureServerEntryExports)([i,j,k,l,m]),(0,b.registerServerReference)(i,"40a855675205cd61bee3b2983588b0585a2fedb446",null),(0,b.registerServerReference)(j,"40b1439b7bf5ca65d4a4e2ec00e627b8c12e1293fa",null),(0,b.registerServerReference)(k,"40e7def66ffb97f0baff30760441528635c50f2cb4",null),(0,b.registerServerReference)(l,"604066eb68f804756429ebcd4e2475cbcd251dea51",null),(0,b.registerServerReference)(m,"60dc1f2054eaf353cccf71a8ec09302619ef2ba1f0",null),a.s(["createProject",()=>k,"getProjectByCode",()=>j,"getProjects",()=>i,"updateProjectAccess",()=>l,"updateProjectTeam",()=>m])},37508,a=>{"use strict";var b=a.i(43379),c=a.i(45879);a.s([],91729),a.i(91729),a.s(["001ceff8282c4239bec770d6cac094d371cf582016",()=>b.$$RSC_SERVER_ACTION_0,"40a855675205cd61bee3b2983588b0585a2fedb446",()=>c.getProjects,"40b1439b7bf5ca65d4a4e2ec00e627b8c12e1293fa",()=>c.getProjectByCode,"40e7def66ffb97f0baff30760441528635c50f2cb4",()=>c.createProject,"604066eb68f804756429ebcd4e2475cbcd251dea51",()=>c.updateProjectAccess,"60dc1f2054eaf353cccf71a8ec09302619ef2ba1f0",()=>c.updateProjectTeam],37508)}];

//# sourceMappingURL=Desktop_worflow-app_f7be1bd7._.js.map