module.exports=[53115,(a,b,c)=>{"use strict";function d(a){for(let b=0;b<a.length;b++){let c=a[b];if("function"!=typeof c)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof c}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ensureServerEntryExports",{enumerable:!0,get:function(){return d}})},17606,a=>{"use strict";var b=a.i(51223),c=a.i(63270),d=a.i(13666),e=a.i(66975);async function f(){let a=await (0,c.auth)();if(!a?.user?.id)return[];try{return await d.prisma.user.findMany({select:{id:!0,name:!0,email:!0,avatarUrl:!0,role:!0,managerId:!0,manager:{select:{id:!0,name:!0}}},orderBy:{name:"asc"}})}catch(a){return console.error("Failed to fetch users:",a),[]}}async function g(a,b,f){let g=await (0,c.auth)();if(!g?.user?.id)return{error:"Unauthorized"};try{return await d.prisma.user.update({where:{id:a},data:{role:b,managerId:"none"===f?null:f}}),(0,e.revalidatePath)("/settings/users"),{success:!0}}catch(a){return console.error("Failed to update user:",a),{error:"Failed to update user"}}}(0,a.i(53115).ensureServerEntryExports)([f,g]),(0,b.registerServerReference)(f,"00052ab1fab1b8579fa088cb15217f3f2c849b69f1",null),(0,b.registerServerReference)(g,"70efc01e1693331f116310be4b7f9679e63cbd9d54",null),a.s(["getUsers",()=>f,"updateUserRoleAndManager",()=>g])},69744,a=>{"use strict";var b=a.i(51223),c=a.i(63270),d=a.i(13666),e=a.i(66975),f=a.i(49341),g=a.i(53115);let h=f.z.object({workItemId:f.z.string().optional(),durationMinutes:f.z.coerce.number().min(1,"Duration must be at least 1 minute"),notes:f.z.string().optional(),date:f.z.string().refine(a=>!isNaN(Date.parse(a)),{message:"Invalid date"})});async function i(a){let b=await (0,c.auth)();if(!b?.user?.id)return{error:"Unauthorized"};let f={workItemId:a.get("workItemId")||void 0,durationMinutes:a.get("durationMinutes"),notes:a.get("notes"),date:a.get("date"),projectId:a.get("projectId")||void 0},g=h.safeParse(f);if(!g.success)return{error:g.error.flatten().fieldErrors};let{workItemId:i,durationMinutes:j,notes:k,date:l}=g.data,m=new Date(l);try{let a=f.projectId||null,c=!0;if(i){let b=await d.prisma.workItem.findUnique({where:{id:i},select:{projectId:!0,project:{select:{isBillable:!0}}}});b&&(a=b.projectId,b.project&&(c=b.project.isBillable))}else if(a){let b=await d.prisma.project.findUnique({where:{id:a},select:{isBillable:!0}});b&&(c=b.isBillable)}return await d.prisma.timeEntry.create({data:{userId:b.user.id,workItemId:i||null,projectId:a,durationSeconds:60*j,startedAt:m,notes:k,isBillable:c}}),(0,e.revalidatePath)("/time"),(0,e.revalidatePath)("/dashboard"),(0,e.revalidatePath)("/work"),{success:!0}}catch(a){return console.error("Failed to log time:",a),{error:"Failed to log time"}}}async function j(a,b){let f=await (0,c.auth)();if(!f?.user?.id)return{error:"Unauthorized"};let g=Number(b.get("durationMinutes")),h=b.get("notes"),i=b.get("date");try{return await d.prisma.timeEntry.update({where:{id:a},data:{durationSeconds:60*g,notes:h,startedAt:new Date(i)}}),(0,e.revalidatePath)("/time"),{success:!0}}catch(a){return{error:"Failed to update"}}}async function k(a){let b=await (0,c.auth)();if(!b?.user?.id)return{error:"Unauthorized"};try{return await d.prisma.timeEntry.delete({where:{id:a}}),(0,e.revalidatePath)("/time"),{success:!0}}catch(a){return{error:"Failed to delete"}}}async function l(a){let b=await (0,c.auth)();if(!b?.user?.id)return[];let e=new Date(a);e.setHours(0,0,0,0);let f=new Date(a);return f.setHours(23,59,59,999),await d.prisma.timeEntry.findMany({where:{userId:b.user.id,startedAt:{gte:e,lte:f}},include:{project:!0,workItem:!0},orderBy:{startedAt:"desc"}})}async function m(a){let b=await (0,c.auth)();if(!b?.user?.id)return[];let e=new Date(a),f=e.getDay(),g=e.getDate()-f+(0===f?-6:1),h=new Date(e.setDate(g));h.setHours(0,0,0,0);let i=new Date(h);return i.setDate(h.getDate()+6),i.setHours(23,59,59,999),await d.prisma.timeEntry.findMany({where:{userId:b.user.id,startedAt:{gte:h,lte:i}},include:{project:!0,workItem:!0},orderBy:{startedAt:"desc"}})}async function n(){let a=await (0,c.auth)();return a?.user?.id?await d.prisma.timeEntry.findMany({where:{userId:a.user.id},orderBy:{startedAt:"desc"},take:20,include:{workItem:{select:{title:!0,project:{select:{name:!0}}}}}}):[]}async function o(){let a=await (0,c.auth)();if(!a?.user?.id)return{totalSeconds:0,entries:[]};let b=new Date,e=new Date(b.setDate(b.getDate()-b.getDay()));e.setHours(0,0,0,0);let f=await d.prisma.timeEntry.findMany({where:{userId:a.user.id,startedAt:{gte:e}}});return{totalSeconds:f.reduce((a,b)=>a+b.durationSeconds,0),count:f.length}}async function p(a,b,e){let f=await (0,c.auth)();if(!f?.user?.id)return{error:"Unauthorized"};let g={startedAt:{gte:a,lte:b}};e?.userId&&(g.userId=e.userId),e?.projectId&&(g.projectId=e.projectId);try{let a=await d.prisma.timeEntry.findMany({where:g,include:{user:{select:{name:!0,billableRate:!0}},project:{select:{name:!0,billableRate:!0,isBillable:!0}},workItem:{select:{title:!0}}},orderBy:{startedAt:"desc"}}),b=0,c=0,e=0,f=0,h={};return a.forEach(a=>{let d=a.durationSeconds/3600;b+=d;let g=a.startedAt.toISOString().split("T")[0];h[g]=(h[g]||0)+d;let i=a.project?.billableRate??a.user.billableRate??0;a.isBillable&&(a.project?.isBillable??!0)?(c+=d,e+=d*i):f+=d*i}),{summary:{totalHours:b,billableHours:c,billableAmount:e,unbilledAmount:f,utilization:b>0?c/b*100:0},chartData:Object.entries(h).map(([a,b])=>({date:a,hours:b})).sort((a,b)=>a.date.localeCompare(b.date)),entries:a}}catch(a){return console.error("Failed to fetch report data:",a),{error:"Failed to fetch report data"}}}(0,g.ensureServerEntryExports)([i,j,k,l,m,n,o,p]),(0,b.registerServerReference)(i,"40deae6ebaa52a70822af3eb0b42528abe6cf6d7c3",null),(0,b.registerServerReference)(j,"60d99d512224072820df7e1159eacbb586c5005db0",null),(0,b.registerServerReference)(k,"400c47ae8a89147b1091c561c4c4b1e3ca9240ab94",null),(0,b.registerServerReference)(l,"4065cd69cb70ccd22858f791e78db2773536cde888",null),(0,b.registerServerReference)(m,"4089bdcc2a85a95426ecb675bc92504aa16935b62f",null),(0,b.registerServerReference)(n,"00257455a1f802617d436aabdafc3097c7550037d4",null),(0,b.registerServerReference)(o,"000b9d26d6f76e437f5a613fac1daf7261cc91b502",null),(0,b.registerServerReference)(p,"70860bd8f29cf04b16df2cd09e644336685fb2121a",null),a.s(["deleteTimeEntry",()=>k,"getDailyEntries",()=>l,"getRecentTimeEntries",()=>n,"getReportData",()=>p,"getWeeklyEntries",()=>m,"getWeeklySummary",()=>o,"logTime",()=>i,"updateTimeEntry",()=>j])},45879,a=>{"use strict";var b=a.i(51223),c=a.i(63270),d=a.i(13666),e=a.i(66975),f=a.i(49341),g=a.i(53115);let h=f.z.object({name:f.z.string().min(2),code:f.z.string().min(2).max(10).toUpperCase(),description:f.z.string().optional()});async function i(a){let b=await (0,c.auth)();if(!b?.user?.id)return[];try{return await d.prisma.project.findMany({where:{users:{some:{id:b.user.id}},...a?{OR:[{name:{contains:a}},{code:{contains:a}}]}:{}},orderBy:{updatedAt:"desc"},include:{_count:{select:{workItems:!0}},users:{select:{id:!0,name:!0,avatarUrl:!0}},workItems:{orderBy:{updatedAt:"desc"},take:20}}})}catch(a){return console.error("Failed to fetch projects:",a),[]}}async function j(a){let b=await (0,c.auth)();if(!b?.user?.id)return null;try{return await d.prisma.project.findUnique({where:{code:a},include:{users:{select:{id:!0,name:!0,email:!0,avatarUrl:!0}},manager:{select:{id:!0,name:!0,email:!0,avatarUrl:!0}},senior:{select:{id:!0,name:!0,email:!0,avatarUrl:!0}},associate:{select:{id:!0,name:!0,email:!0,avatarUrl:!0}},assignedTemplates:!0,workItems:{orderBy:{updatedAt:"desc"},take:20}}})}catch(a){return console.error("Failed to fetch project:",a),null}}async function k(a){let b=await (0,c.auth)();if(!b?.user?.id)return{error:"Unauthorized"};let f={name:a.get("name"),code:a.get("code"),description:a.get("description")},g=h.safeParse(f);if(!g.success)return{error:g.error.flatten().fieldErrors};try{return await d.prisma.project.create({data:{...g.data,users:{connect:{id:b.user.id}}}}),(0,e.revalidatePath)("/projects"),{success:!0}}catch(a){return{error:"Failed to create project. Code might be duplicate."}}}async function l(a,b){let f=await (0,c.auth)();if(!f?.user?.id)return{error:"Unauthorized"};try{if(!await d.prisma.project.findFirst({where:{code:a,users:{some:{id:f.user.id}}}}))return{error:"Project not found or unauthorized"};return await d.prisma.project.update({where:{code:a},data:{users:{set:b.map(a=>({id:a}))}}}),(0,e.revalidatePath)(`/projects/${a}`),(0,e.revalidatePath)("/projects"),{success:!0}}catch(a){return console.error("Failed to update project access:",a),{error:"Failed to update access"}}}async function m(a,b){let f=await (0,c.auth)();if(!f?.user?.id)return{error:"Unauthorized"};try{let c={managerId:"none"===b.managerId?null:b.managerId,seniorId:"none"===b.seniorId?null:b.seniorId,associateId:"none"===b.associateId?null:b.associateId,allowedTaskTypes:b.allowedTaskTypes};return b.assignedTemplateIds&&(c.assignedTemplates={set:b.assignedTemplateIds.map(a=>({id:a}))}),await d.prisma.project.update({where:{code:a},data:c}),(0,e.revalidatePath)(`/projects/${a}`),{success:!0}}catch(a){return console.error("Failed to update project team:",a),{error:"Failed to update project team"}}}(0,g.ensureServerEntryExports)([i,j,k,l,m]),(0,b.registerServerReference)(i,"40a855675205cd61bee3b2983588b0585a2fedb446",null),(0,b.registerServerReference)(j,"40b1439b7bf5ca65d4a4e2ec00e627b8c12e1293fa",null),(0,b.registerServerReference)(k,"40e7def66ffb97f0baff30760441528635c50f2cb4",null),(0,b.registerServerReference)(l,"604066eb68f804756429ebcd4e2475cbcd251dea51",null),(0,b.registerServerReference)(m,"60dc1f2054eaf353cccf71a8ec09302619ef2ba1f0",null),a.s(["createProject",()=>k,"getProjectByCode",()=>j,"getProjects",()=>i,"updateProjectAccess",()=>l,"updateProjectTeam",()=>m])},44663,58473,25873,a=>{"use strict";let b=Symbol.for("constructDateFrom");function c(a,c){return"function"==typeof a?a(c):a&&"object"==typeof a&&b in a?a[b](c):a instanceof Date?new a.constructor(c):new Date(c)}function d(a,b){return c(b||a,a)}a.s(["constructFromSymbol",0,b,"minutesInDay",0,1440,"minutesInMonth",0,43200],58473),a.s(["constructFrom",()=>c],25873),a.s(["toDate",()=>d],44663)},77103,a=>{"use strict";var b=a.i(25873),c=a.i(44663);function d(a,d,e){let f=(0,c.toDate)(a,e?.in);return isNaN(d)?(0,b.constructFrom)(e?.in||a,NaN):(d&&f.setDate(f.getDate()+d),f)}a.s(["addDays",()=>d])},39601,a=>{"use strict";var b=a.i(51223),c=a.i(63270),d=a.i(13666),e=a.i(66975),f=a.i(49341),g=a.i(77103),h=a.i(53115);let i=f.z.object({name:f.z.string().min(2),description:f.z.string().optional()}),j=f.z.object({groupId:f.z.string(),title:f.z.string().min(1),relativeDueDays:f.z.coerce.number().min(0),priority:f.z.enum(["P0","P1","P2","P3"]),requiresDocument:f.z.boolean().optional(),isRecurring:f.z.boolean().optional(),recurrenceInterval:f.z.enum(["DAILY","WEEKLY","MONTHLY","QUARTERLY","YEARLY"]).optional().nullable()});async function k(){let a=await (0,c.auth)();if(!a?.user?.id)return[];try{return await d.prisma.taskTemplateGroup.findMany({include:{templates:!0},orderBy:{name:"asc"}})}catch(a){return console.error("Failed to fetch template groups:",a),[]}}async function l(a){let b=await (0,c.auth)();if(!b?.user?.id)return{error:"Unauthorized"};let f={name:a.get("name"),description:a.get("description")},g=i.safeParse(f);if(!g.success)return{error:g.error.flatten().fieldErrors};try{return await d.prisma.taskTemplateGroup.create({data:g.data}),(0,e.revalidatePath)("/templates"),{success:!0}}catch(a){return{error:"Failed to create template group"}}}async function m(a){let b=await (0,c.auth)();if(!b?.user?.id)return{error:"Unauthorized"};let f={groupId:a.get("groupId"),title:a.get("title"),relativeDueDays:a.get("relativeDueDays"),priority:a.get("priority"),requiresDocument:"on"===a.get("requiresDocument"),isRecurring:"on"===a.get("isRecurring"),recurrenceInterval:a.get("recurrenceInterval")||null},g=j.safeParse(f);if(!g.success)return{error:g.error.flatten().fieldErrors};try{return await d.prisma.taskTemplate.create({data:{...g.data,recurrenceInterval:g.data.isRecurring?g.data.recurrenceInterval:null}}),(0,e.revalidatePath)("/templates"),{success:!0}}catch(a){return{error:"Failed to add task template"}}}let n=f.z.object({groupId:f.z.string(),projectIds:f.z.string().transform((a,b)=>{try{return JSON.parse(a)}catch(a){return b.addIssue({code:"custom",message:"Invalid project IDs"}),f.z.NEVER}}),startDate:f.z.string().refine(a=>!isNaN(Date.parse(a)),{message:"Invalid date"})});async function o(a){let b=await (0,c.auth)();if(!b?.user?.id)return{error:"Unauthorized"};let f={groupId:a.get("groupId"),projectIds:a.get("projectIds"),startDate:a.get("startDate")},h=n.safeParse(f);if(!h.success)return{error:h.error.flatten().fieldErrors};let{groupId:i,projectIds:j,startDate:k}=h.data,l=new Date(k),m=await d.prisma.taskTemplateGroup.findUnique({where:{id:i},include:{templates:!0}});if(!m||0===m.templates.length)return{error:"Template group not found or empty"};let o=0;for(let a of j){let b=await d.prisma.project.findUnique({where:{id:a},select:{id:!0,managerId:!0,seniorId:!0,associateId:!0}});if(!b)continue;let c=m.templates.map(c=>{let d=null;return"MANAGER"===c.assigneeRole?d=b.managerId:"SENIOR"===c.assigneeRole?d=b.seniorId:"ASSOCIATE"===c.assigneeRole&&(d=b.associateId),{title:c.title,status:"OPEN",priority:c.priority,projectId:a,assigneeId:d,requiresDocument:c.requiresDocument,dueDate:null!==c.relativeDueDays?(0,g.addDays)(l,c.relativeDueDays):null,description:c.description||`Generated from template: ${m.name}`,isRecurring:c.isRecurring,recurrenceInterval:c.recurrenceInterval,recurrenceDays:c.recurrenceDays}});o+=(await d.prisma.workItem.createMany({data:c})).count}return(0,e.revalidatePath)("/work"),(0,e.revalidatePath)("/projects"),{success:!0,count:o}}(0,h.ensureServerEntryExports)([k,l,m,o]),(0,b.registerServerReference)(k,"00358667da5bfb6c277245af1b139d9f1e39a6702b",null),(0,b.registerServerReference)(l,"40e79c0cfd15a30b45d71de37c650feb8db0428621",null),(0,b.registerServerReference)(m,"4049d6c2d3215fc3c342cd16f8a6a641c9a1ad20b6",null),(0,b.registerServerReference)(o,"40af175758ed1ea7775fff85f42624b6665e96166d",null),a.s(["addTaskToGroup",()=>m,"createTemplateGroup",()=>l,"getTemplateGroups",()=>k,"runTemplate",()=>o])},67761,a=>{"use strict";var b=a.i(51223),c=a.i(49341),d=a.i(13666),e=a.i(63270),f=a.i(66975),g=a.i(77103);function h(a,b,c){return(0,g.addDays)(a,7*b,c)}var i=a.i(25873),j=a.i(44663);function k(a,b,c){let d=(0,j.toDate)(a,c?.in);if(isNaN(b))return(0,i.constructFrom)(c?.in||a,NaN);if(!b)return d;let e=d.getDate(),f=(0,i.constructFrom)(c?.in||a,d.getTime());return(f.setMonth(d.getMonth()+b+1,0),e>=f.getDate())?f:(d.setFullYear(f.getFullYear(),f.getMonth(),e),d)}var l=a.i(53115);let m=c.z.object({title:c.z.string().min(1),description:c.z.string().optional(),status:c.z.string().default("OPEN"),priority:c.z.string().default("P2"),driveLink:c.z.string().optional().nullable(),driveLinkType:c.z.string().optional().nullable(),requiresDocument:c.z.boolean().default(!1),dueDate:c.z.string().optional().nullable().transform(a=>a?new Date(a):null),isRecurring:c.z.boolean().default(!1),recurrenceInterval:c.z.enum(["DAILY","WEEKLY","MONTHLY","QUARTERLY","YEARLY"]).or(c.z.literal("")).optional().nullable().transform(a=>""===a?null:a),recurrenceDays:c.z.string().optional().nullable(),projectId:c.z.string().optional().nullable(),taskType:c.z.string().optional().nullable()}).refine(a=>!a.isRecurring||!!a.dueDate,{message:"Due date is required for recurring tasks",path:["dueDate"]}).refine(a=>!a.projectId||!!a.taskType,{message:"Task Type is required for project tasks",path:["taskType"]});async function n(a){let b=await (0,e.auth)();if(!b?.user?.id)return{success:!1,message:"Unauthorized"};let g={title:a.get("title"),description:a.get("description"),status:a.get("status")||"OPEN",priority:a.get("priority")||"P2",driveLink:a.get("driveLink"),driveLinkType:a.get("driveLinkType"),requiresDocument:"on"===a.get("requiresDocument"),dueDate:a.get("dueDate"),isRecurring:!!a.get("recurrenceInterval"),recurrenceInterval:a.get("recurrenceInterval")||null,recurrenceDays:a.get("recurrenceDays")||null,projectId:"none"===a.get("projectId")?null:a.get("projectId"),taskType:"none"===a.get("taskType")?null:a.get("taskType")};try{let a=m.parse(g);if(a.isRecurring&&"WEEKLY"===a.recurrenceInterval&&!a.recurrenceDays)return{success:!1,message:"Weekly recurrence requires at least one day selected."};return await d.prisma.workItem.create({data:{title:a.title,description:a.description,status:a.status,priority:a.priority,driveLink:a.driveLink||null,driveLinkType:a.driveLinkType||null,requiresDocument:a.requiresDocument,dueDate:a.dueDate,assigneeId:b.user.id,isRecurring:a.isRecurring,recurrenceInterval:a.isRecurring?a.recurrenceInterval:null,recurrenceDays:a.isRecurring?a.recurrenceDays:null,projectId:a.projectId||null,taskType:a.taskType||null}}),(0,f.revalidatePath)("/work"),(0,f.revalidatePath)("/dashboard"),(0,f.revalidatePath)("/clients"),{success:!0}}catch(a){if(a instanceof c.z.ZodError)return console.error("Validation failed:",a.flatten()),{success:!1,message:"Validation failed. Please check your inputs.",errors:a.flatten().fieldErrors};return console.error("Failed to create task:",a),{success:!1,message:"Failed to create task"}}}async function o(a,b){let c=await (0,e.auth)();if(!c?.user?.id)return{success:!1,message:"Unauthorized"};try{let c=await d.prisma.workItem.findUnique({where:{id:a}});if(!c)return{success:!1,message:"Task not found"};if("DONE"===b&&c.requiresDocument&&!c.driveLink)return{success:!1,message:"Document required to complete this task.",requiresDocument:!0};if("DONE"===b&&c.isRecurring&&c.recurrenceInterval){let a=function(a,b,c){let d=new Date(a);if(d.setHours(0,0,0,0),"WEEKLY"===b&&c){let a=c.split(",").map(a=>a.trim()),b={Sun:0,Mon:1,Tue:2,Wed:3,Thu:4,Fri:5,Sat:6},e=a.map(a=>b[a]).sort((a,b)=>a-b);if(0===e.length)return h(d,1);let f=d.getDay(),i=e.find(a=>a>f);if(void 0!==i)return(0,g.addDays)(d,i-f);{let a=e[0];return(0,g.addDays)(d,7-f+a)}}switch(b){case"DAILY":default:return(0,g.addDays)(d,1);case"WEEKLY":return h(d,1);case"MONTHLY":return k(d,1);case"QUARTERLY":return k(d,3,void 0);case"YEARLY":return k(d,12,void 0)}}(new Date,c.recurrenceInterval,c.recurrenceDays);await d.prisma.workItem.create({data:{title:c.title,description:c.description,status:"OPEN",priority:c.priority,projectId:c.projectId,assigneeId:c.assigneeId,requiresDocument:c.requiresDocument,isRecurring:!0,recurrenceInterval:c.recurrenceInterval,recurrenceDays:c.recurrenceDays,dueDate:a}})}return await d.prisma.workItem.update({where:{id:a},data:{status:b,completedAt:"DONE"===b?new Date:null}}),(0,f.revalidatePath)("/work"),(0,f.revalidatePath)("/dashboard"),{success:!0,message:"Task updated"}}catch(a){return console.error("Failed to update status:",a),{success:!1,message:"Failed to update status"}}}async function p(a,b){let g=await (0,e.auth)();if(!g?.user?.id)return{success:!1,message:"Unauthorized"};if(!c.z.string().url().safeParse(b).success)return{success:!1,message:"Invalid URL"};try{return await d.prisma.workItem.update({where:{id:a},data:{driveLink:b,driveLinkType:"file"}}),(0,f.revalidatePath)("/work"),{success:!0,message:"Link added"}}catch(a){return console.error("Failed to add link:",a),{success:!1,message:"Failed to add link"}}}async function q(a){let b=await (0,e.auth)();if(!b?.user?.id)return[];let c=b.user.id,f=await d.prisma.user.findUnique({where:{id:c},include:{manager:!0,directReports:{include:{directReports:!0}}}});if(!f)return[];let g=[c];"SENIOR"===f.role?g=[...g,...f.directReports.map(a=>a.id)]:"MANAGER"===f.role?g=[...g,...f.directReports.map(a=>a.id),...f.directReports.flatMap(a=>a.directReports.map(a=>a.id))]:"ADMIN"===f.role&&(g=[]);let h={...a?.projectId?{projectId:a.projectId}:{},...a?.status?{status:a.status}:{},...a?.search?{OR:[{title:{contains:a.search}},{description:{contains:a.search}}]}:{}};if("ADMIN"!==f.role?h.assigneeId={in:g}:a?.assigneeId&&(h.assigneeId=a.assigneeId),a?.assigneeId&&"ADMIN"!==f.role)if(!g.includes(a.assigneeId))return[];else h.assigneeId=a.assigneeId;try{return await d.prisma.workItem.findMany({where:h,orderBy:{updatedAt:"desc"},include:{project:{select:{code:!0,name:!0}},assignee:{select:{name:!0,avatarUrl:!0}}}})}catch(a){return console.error("Failed to get work items:",a),[]}}async function r(a,b){let c=await (0,e.auth)();if(!c?.user?.id)return{success:!1,message:"Unauthorized"};try{let c={title:b.get("title"),description:b.get("description"),priority:b.get("priority"),dueDate:b.get("dueDate")?new Date(b.get("dueDate")):null,assigneeId:b.get("assigneeId")||null};return await d.prisma.workItem.update({where:{id:a},data:{title:c.title,description:c.description,priority:c.priority,dueDate:c.dueDate,assigneeId:c.assigneeId}}),(0,f.revalidatePath)("/work"),(0,f.revalidatePath)("/dashboard"),(0,f.revalidatePath)("/projects"),{success:!0,message:"Task updated"}}catch(a){return console.error("Failed to update task details:",a),{success:!1,message:"Failed to update task"}}}(0,l.ensureServerEntryExports)([n,o,p,q,r]),(0,b.registerServerReference)(n,"40de94d4fb47b51c032dc1b7c6904a3de8ef162157",null),(0,b.registerServerReference)(o,"608cd521f1bcabf563c0befe8fca451c47b273ae83",null),(0,b.registerServerReference)(p,"606c4a5080886e51df4612ed481e375dbbea6efeea",null),(0,b.registerServerReference)(q,"4029096d674055419dc222a9725bbb7f671bbd253e",null),(0,b.registerServerReference)(r,"60f7368a61b3983e3a158b9de58e792547353665de",null),a.s(["addDocumentLink",()=>p,"createTask",()=>n,"getWorkItems",()=>q,"updateTaskDetails",()=>r,"updateTaskStatus",()=>o],67761)},6397,a=>{"use strict";var b=a.i(43379),c=a.i(45879),d=a.i(67761),e=a.i(17606),f=a.i(39601),g=a.i(69744);a.s([],33854),a.i(33854),a.s(["00052ab1fab1b8579fa088cb15217f3f2c849b69f1",()=>e.getUsers,"001ceff8282c4239bec770d6cac094d371cf582016",()=>b.$$RSC_SERVER_ACTION_0,"00358667da5bfb6c277245af1b139d9f1e39a6702b",()=>f.getTemplateGroups,"400c47ae8a89147b1091c561c4c4b1e3ca9240ab94",()=>g.deleteTimeEntry,"4029096d674055419dc222a9725bbb7f671bbd253e",()=>d.getWorkItems,"4049d6c2d3215fc3c342cd16f8a6a641c9a1ad20b6",()=>f.addTaskToGroup,"40a855675205cd61bee3b2983588b0585a2fedb446",()=>c.getProjects,"40af175758ed1ea7775fff85f42624b6665e96166d",()=>f.runTemplate,"40b1439b7bf5ca65d4a4e2ec00e627b8c12e1293fa",()=>c.getProjectByCode,"40de94d4fb47b51c032dc1b7c6904a3de8ef162157",()=>d.createTask,"40deae6ebaa52a70822af3eb0b42528abe6cf6d7c3",()=>g.logTime,"40e79c0cfd15a30b45d71de37c650feb8db0428621",()=>f.createTemplateGroup,"40e7def66ffb97f0baff30760441528635c50f2cb4",()=>c.createProject,"604066eb68f804756429ebcd4e2475cbcd251dea51",()=>c.updateProjectAccess,"606c4a5080886e51df4612ed481e375dbbea6efeea",()=>d.addDocumentLink,"608cd521f1bcabf563c0befe8fca451c47b273ae83",()=>d.updateTaskStatus,"60d99d512224072820df7e1159eacbb586c5005db0",()=>g.updateTimeEntry,"60dc1f2054eaf353cccf71a8ec09302619ef2ba1f0",()=>c.updateProjectTeam,"60f7368a61b3983e3a158b9de58e792547353665de",()=>d.updateTaskDetails,"70efc01e1693331f116310be4b7f9679e63cbd9d54",()=>e.updateUserRoleAndManager],6397)}];

//# sourceMappingURL=Desktop_worflow-app_f27d5735._.js.map