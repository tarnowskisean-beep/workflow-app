module.exports=[53115,(a,b,c)=>{"use strict";function d(a){for(let b=0;b<a.length;b++){let c=a[b];if("function"!=typeof c)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof c}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ensureServerEntryExports",{enumerable:!0,get:function(){return d}})},44663,58473,25873,a=>{"use strict";let b=Symbol.for("constructDateFrom");function c(a,c){return"function"==typeof a?a(c):a&&"object"==typeof a&&b in a?a[b](c):a instanceof Date?new a.constructor(c):new Date(c)}function d(a,b){return c(b||a,a)}a.s(["constructFromSymbol",0,b,"minutesInDay",0,1440,"minutesInMonth",0,43200],58473),a.s(["constructFrom",()=>c],25873),a.s(["toDate",()=>d],44663)},77103,a=>{"use strict";var b=a.i(25873),c=a.i(44663);function d(a,d,e){let f=(0,c.toDate)(a,e?.in);return isNaN(d)?(0,b.constructFrom)(e?.in||a,NaN):(d&&f.setDate(f.getDate()+d),f)}a.s(["addDays",()=>d])},39601,a=>{"use strict";var b=a.i(51223),c=a.i(63270),d=a.i(13666),e=a.i(66975),f=a.i(49341),g=a.i(77103),h=a.i(53115);let i=f.z.object({name:f.z.string().min(2),description:f.z.string().optional()}),j=f.z.object({groupId:f.z.string(),title:f.z.string().min(1),relativeDueDays:f.z.coerce.number().min(0),priority:f.z.enum(["P0","P1","P2","P3"]),requiresDocument:f.z.boolean().optional(),isRecurring:f.z.boolean().optional(),recurrenceInterval:f.z.enum(["DAILY","WEEKLY","MONTHLY","QUARTERLY","YEARLY"]).optional().nullable()});async function k(){let a=await (0,c.auth)();if(!a?.user?.id)return[];try{return await d.prisma.taskTemplateGroup.findMany({include:{templates:!0},orderBy:{name:"asc"}})}catch(a){return console.error("Failed to fetch template groups:",a),[]}}async function l(a){let b=await (0,c.auth)();if(!b?.user?.id)return{error:"Unauthorized"};let f={name:a.get("name"),description:a.get("description")},g=i.safeParse(f);if(!g.success)return{error:g.error.flatten().fieldErrors};try{return await d.prisma.taskTemplateGroup.create({data:g.data}),(0,e.revalidatePath)("/templates"),{success:!0}}catch(a){return{error:"Failed to create template group"}}}async function m(a){let b=await (0,c.auth)();if(!b?.user?.id)return{error:"Unauthorized"};let f={groupId:a.get("groupId"),title:a.get("title"),relativeDueDays:a.get("relativeDueDays"),priority:a.get("priority"),requiresDocument:"on"===a.get("requiresDocument"),isRecurring:"on"===a.get("isRecurring"),recurrenceInterval:a.get("recurrenceInterval")||null},g=j.safeParse(f);if(!g.success)return{error:g.error.flatten().fieldErrors};try{return await d.prisma.taskTemplate.create({data:{...g.data,recurrenceInterval:g.data.isRecurring?g.data.recurrenceInterval:null}}),(0,e.revalidatePath)("/templates"),{success:!0}}catch(a){return{error:"Failed to add task template"}}}let n=f.z.object({groupId:f.z.string(),projectIds:f.z.string().transform((a,b)=>{try{return JSON.parse(a)}catch(a){return b.addIssue({code:"custom",message:"Invalid project IDs"}),f.z.NEVER}}),startDate:f.z.string().refine(a=>!isNaN(Date.parse(a)),{message:"Invalid date"})});async function o(a){let b=await (0,c.auth)();if(!b?.user?.id)return{error:"Unauthorized"};let f={groupId:a.get("groupId"),projectIds:a.get("projectIds"),startDate:a.get("startDate")},h=n.safeParse(f);if(!h.success)return{error:h.error.flatten().fieldErrors};let{groupId:i,projectIds:j,startDate:k}=h.data,l=new Date(k),m=await d.prisma.taskTemplateGroup.findUnique({where:{id:i},include:{templates:!0}});if(!m||0===m.templates.length)return{error:"Template group not found or empty"};let o=0;for(let a of j){let b=await d.prisma.project.findUnique({where:{id:a},select:{id:!0,managerId:!0,seniorId:!0,associateId:!0}});if(!b)continue;let c=m.templates.map(c=>{let d=null;return"MANAGER"===c.assigneeRole?d=b.managerId:"SENIOR"===c.assigneeRole?d=b.seniorId:"ASSOCIATE"===c.assigneeRole&&(d=b.associateId),{title:c.title,status:"OPEN",priority:c.priority,projectId:a,assigneeId:d,requiresDocument:c.requiresDocument,dueDate:null!==c.relativeDueDays?(0,g.addDays)(l,c.relativeDueDays):null,description:c.description||`Generated from template: ${m.name}`,isRecurring:c.isRecurring,recurrenceInterval:c.recurrenceInterval,recurrenceDays:c.recurrenceDays}});o+=(await d.prisma.workItem.createMany({data:c})).count}return(0,e.revalidatePath)("/work"),(0,e.revalidatePath)("/projects"),{success:!0,count:o}}(0,h.ensureServerEntryExports)([k,l,m,o]),(0,b.registerServerReference)(k,"00358667da5bfb6c277245af1b139d9f1e39a6702b",null),(0,b.registerServerReference)(l,"40e79c0cfd15a30b45d71de37c650feb8db0428621",null),(0,b.registerServerReference)(m,"4049d6c2d3215fc3c342cd16f8a6a641c9a1ad20b6",null),(0,b.registerServerReference)(o,"40af175758ed1ea7775fff85f42624b6665e96166d",null),a.s(["addTaskToGroup",()=>m,"createTemplateGroup",()=>l,"getTemplateGroups",()=>k,"runTemplate",()=>o])},65009,a=>{"use strict";var b=a.i(43379),c=a.i(39601);a.s([],93048),a.i(93048),a.s(["001ceff8282c4239bec770d6cac094d371cf582016",()=>b.$$RSC_SERVER_ACTION_0,"00358667da5bfb6c277245af1b139d9f1e39a6702b",()=>c.getTemplateGroups,"4049d6c2d3215fc3c342cd16f8a6a641c9a1ad20b6",()=>c.addTaskToGroup,"40af175758ed1ea7775fff85f42624b6665e96166d",()=>c.runTemplate,"40e79c0cfd15a30b45d71de37c650feb8db0428621",()=>c.createTemplateGroup],65009)}];

//# sourceMappingURL=Desktop_worflow-app_beb4ed4c._.js.map